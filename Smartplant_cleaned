  // Smartplant.ino
  // Created by LS,JB

// ALLNET Gas MQ2 Sensor B33
int gasSensorPin = A15;

// Photoresistor/Lichtsensor B30
int lightSensorPin = A9;

// ALLNET 5V Relay Modul B02
int relayPin = 47;

// DHT11 Sensor
#include "DHT.h"
#define DHTPIN 47
#define DHTTYPE DHT11
DHT dht(DHTPIN, DHTTYPE);

void setup() {
  // Starten der seriellen Ãœbertragung
  Serial.begin(9600);

  // Zuweisen der Pin Funktion
  pinMode(gasSensorPin, INPUT);
  pinMode(lightSensorPin, INPUT);
  pinMode(relayPin, OUTPUT);

  // DHT11 Sensor wird gestartet
  dht.begin();

  // Initiale Ausgabe
  Serial.println("Setup abgeschlossen!");
}

void loop() {
  // Lichtsensor auslesen und verarbeiten
  readLightSensor();

  // DHT11 Sensor auslesen und verarbeiten
  readDHTSensor();

  // Gassensor auslesen und verarbeiten
  readGasSensor();

  // Relay Modul steuern
  controlRelay();

  // Kurze Pause zwischen den Messungen
  delay(2000);
}

void readLightSensor() {
  int rawValue = analogRead(lightSensorPin);
  float voltage = rawValue * (5.0 / 1023) * 1000;
  float resistance = 10000 * (voltage / (5000.0 - voltage));

  Serial.print("Lichtsensor - Spannungswert: ");
  Serial.print(voltage);
  Serial.print(" mV, Widerstandswert: ");
  Serial.print(resistance);
  Serial.println(" Ohm");
  Serial.println("---------------------------------------");
}

void readDHTSensor() {
  // Wartezeit vor dem Auslesen des DHT11 Sensors
  delay(2000);

  float humidity = dht.readHumidity();
  float temperatureC = dht.readTemperature();
  float temperatureF = dht.readTemperature(true);

  if (isnan(humidity) || isnan(temperatureC) || isnan(temperatureF)) {
    Serial.println("Failed to read from DHT sensor!");
    return;
  }

  float heatIndexC = dht.computeHeatIndex(temperatureC, humidity, false);
  float heatIndexF = dht.computeHeatIndex(temperatureF, humidity);

  Serial.print("DHT11 Sensor - Luftfeuchtigkeit: ");
  Serial.print(humidity);
  Serial.print(" %\tTemperatur: ");
  Serial.print(temperatureC);
  Serial.print(" *C ");
  Serial.print(temperatureF);
  Serial.print(" *F\tHeat index: ");
  Serial.print(heatIndexC);
  Serial.print(" *C ");
  Serial.print(heatIndexF);
  Serial.println(" *F");
  Serial.println("---------------------------------------");
}

void readGasSensor() {
  int val = analogRead(gasSensorPin);
  Serial.print("Gassensor - Sensor Wert: ");
  Serial.println(val);
  Serial.println("---------------------------------------");
}

void controlRelay() {
  digitalWrite(relayPin, HIGH);
  delay(3000);
  digitalWrite(relayPin, LOW);
  delay(3000);
}
